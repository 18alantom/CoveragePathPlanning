<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="/static/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/static/icofont.min.css" rel="stylesheet">
  <link href="/static/map.css" rel="stylesheet" type="text/css">
  <title>SIH MAP</title>
</head>
<style>
  html,
  body {
    margin: 0;
    height: 100%;
  }
</style>

<body>

  <div id=container>
    <div id="left">

      <div class="form-box1">
        <form id="register1" class="input-group1">
          <img src="static\2025680.svg" id="image">
          <h3 style="margin-top: 40px"><b>INPUTS FOR THE PROGRAM</b></h3>
          <input type="number" class="input-field1" id="drone" placeholder="Number of drones" required>
          <input type="number" class="input-field1" id="altitude" placeholder="Altitude" required>
          <input type="number" class="input-field1" id="fov" placeholder="Field Of Vision(Angle)" required>
          <input type="file" name="shapefile" id="shapefile" />
          <div class="select1">
            <select id="select_input">
              <option value="obstacle_present">Obstacle Known</option>
              <option value="no_obstacle">Obstacle Unknown</option>
            </select>
          </div>
          <h4 id="heading">DRONE 1</h4>
          <input type="number" class="input-field1" id="range" placeholder="Range (in km based on battery life)"
            required>
          <input type="number" class="input-field1" id="speed" placeholder="Top speed (in km/hr)" required>
          <button type="submit" class="submit-btn1" id="button5"><b>NEXT</b></button>
        </form>
      </div>
    </div>
    <div id="center">
      <div id="map"></div>
      <div id="controls">


        <div id=toggle_button>
          <button class="control_button" id="button"><b> ADD OBSTACLE </b> </button>
          <button class="control_button" id="button1"><b> CREATE OBSTACLE </b> </button>
          <button class="control_button" id="button2"><b> DELETE NODE </b> </button>
          <button class="control_button" id="button3"><b> SUBMIT </b> </button>
          <button class="control_button" id="button4"><b> ANIMATION </b> </button>
          <button class="control_button" id="button6"><b> ADD FUEL ST. </b> </button>
          <button class="control_button" id="button7"><b> DELETE FUEL ST. </b> </button>
          <button class="control_button" id="button8"><b> ADD START PT. </b> </button>
          <button class="control_button" id="button9"><b> DELETE START PT. </b> </button>
        </div>


      </div>

    </div>
    <div id="right">

      <div id="form-box2">

        <img src="static\SIH_2018_logo.png" id="image1">

        <h3 style="margin-top: 40px"><b>OUTPUT</b></h3>
        <h5 style="padding-top: 10px"><b> Current Progress: </b></h5>
        <progress id="file" value="0" max="100"> 32% </progress>
        <h5><b> Total Area Covered: </b></h5>
        <input type="text" name="total_area" id="output"><br>
        <h5 style="padding-top: 10px"><b> Select Drone: </b></h5>
        <div class="select2">
          <select id="select_input1">
            <option value="drone1">Drone 1</option>

          </select>
        </div>
        <h5 style="padding-top: 10px"><b> Drone Progress: </b></h5>
        <progress id="file1" value="0" max="100"> </progress>
        <h5 style="padding-top: 10px"><b> Drone Battery: </b></h5>
        <progress id="file2" value="100" max="100"></progress>
      </div>
    </div>


  </div>
  <script>
    const POINT_NAME = "layers/POINT";
    const POLY_NAME = "layers/POLYGON";
    const OBSTACLE = "obstacle";
    const COVERAGE = "coverage";
    const fileSelector = document.getElementById("shapefile");
    let shapefile_polygon;
    let shapefile_geojson;
    let input;
    let poly_arr = [];
    let obst_arr = [];
    let path_arr = [];
    let midpoint;
    let bigarr = [];
    let drone_arr = [];
    let drone_val = [];
    let drone_len = [];
    let flag_fuel = false;
    let flag_strt = false;

    fileSelector.addEventListener("change", (e) => {
      const shapefile = e.target.files[0];
      const reader = new FileReader();
      reader.readAsArrayBuffer(shapefile);
      reader.onload = onLoadHandler;
    });
    function onLoadHandler() {
      shp(this.result).then((geojson) => {

        shapefile_geojson = geojson;
        console.log(shapefile_geojson);
        // geojson_ = geojson;
        let coverageFeatureCollection = null;
        const obstacles = [];
        const coverage = [];
        // console.log(geojson);
        geojson.forEach((element) => {
          if (element.fileName == POINT_NAME) {
            map.data.addGeoJson(element);
          }
          if ((element.fileName = POLY_NAME)) {
            element.features.forEach((feature) => {
              // Why has he put this weird regex here?
              const type = feature.properties.type.match(/[a-z]*/i)[0];
              const coords = feature.geometry.coordinates[0];
              if (type == COVERAGE) {
                coverage.push(coords);
              }
              else if (type == OBSTACLE) {
                obstacles.push(coords);
              }
              else {
                bloop = type;
              }
            });
          }
        });
        const poly = turf.polygon(coverage);
        const mask = turf.polygon(obstacles);
        console.log(poly);
        console.log(mask);

        //console.log(poly);

        // const finalCoverage = {
        //   type: "FeatureCollection",
        //   features: [turf.mask(poly, mask)],
        // };
        // map.data.addGeoJson(finalCoverage);

        // map.data.setStyle({
        //   fillColor: "lightblue",
        //   strokeWeight: 1,
        //   strokeColor: "blue",
        // });

        const p = turf.mask(poly, mask);
        // console.log(p);
        // console.log(mask);
        const len = mask.geometry.coordinates.length;
        const q = mask.geometry.coordinates;



        for (var i = 0; i < p.geometry.coordinates[1].length; i++) {
          var temp = { lng: p.geometry.coordinates[1][i][0], lat: p.geometry.coordinates[1][i][1] }
          poly_arr.push(temp);
        }


        path_arr.push(poly_arr);

        for (var j = 0; j < len; j++) {
          for (var i = (q[j].length) - 1; i >= 0; i--) {
            var ob_temp = { lng: q[j][i][0], lat: q[j][i][1] }
            obst_arr.push(ob_temp);
          }
          path_arr.push(obst_arr);
          //console.log(path_arr);
          obst_arr = [];
        }

        midpoint = turf.centroid(poly);
        console.log(midpoint);
        const new_center = { lng: midpoint.geometry.coordinates[0], lat: midpoint.geometry.coordinates[1] }
        map = new google.maps.Map(mapContainerDiv, { zoom: 13, center: new_center });

        shapefile_polygon = new google.maps.Polygon(
          {
            paths: path_arr,
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 3,
            fillColor: "#FF0000",
            fillOpacity: 0.35
          });

        shapefile_polygon.setMap(map);


      });

    }
  </script>
  <script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <script>
    let map;
    let arr = [];
    let reverse_arr = [];
    let obs_marker;
    let obs_marker_arr = [];
    let fuel_marker = [];
    let fuel_marker_arr = [];
    let drone_marker = [];
    let drone_marker_arr = [];
    let pathCoords1 = [];
    let pathCoords2 = [];
    let pathCoords = [];
    let route = [];
    let ani_marker = [];
    let range = [];
    let speed = []
    let no_drones = 1;
    let value_no_drones = 0;
    let altitude;
    let fov;
    let side;
    let un_kn_obstacle;
    let mapContainerDiv;
    let temp = 'yash';
    let entry1 = {};

    mapContainerDiv = document.getElementById("map");
    function initMap() {
      const postSIHParty =
      {
        lng: 72.88804829120636,
        lat: 19.080222794769302,
        zoom: 14
      };
      map = new google.maps.Map(mapContainerDiv, { zoom: 12, center: postSIHParty });
      const marker = new google.maps.Marker({ map: map, zoom: 14, position: postSIHParty });


      // Create the initial InfoWindow.
      var infoWindow = new google.maps.InfoWindow(
        {
          content: 'Click on ADD OBSTCALE to get Lat/Lng!', position: postSIHParty
        });

      infoWindow.open(map);

      document.getElementById('button').addEventListener("click", function () {
        shapefile_polygon.addListener('click', function (mapsMouseEvent) {
          // Close the current InfoWindow.
          infoWindow.close();
          // Create a new InfoWindow.
          infoWindow = new google.maps.InfoWindow({ position: mapsMouseEvent.latLng });
          infoWindow.setContent(mapsMouseEvent.latLng.toString());
          infoWindow.open(map);
          const lat = mapsMouseEvent.latLng.lat();
          const lng = mapsMouseEvent.latLng.lng();

          obs_marker = new google.maps.Marker(
            {
              position: mapsMouseEvent.latLng,
              map: map
            });
          obs_marker_arr.push(obs_marker);
          if (flag)
            arr.push({ lng: parseFloat(lng), lat: parseFloat(lat) });
        });

      });

      document.getElementById('button1').addEventListener("click", function () {

        path_arr.push(arr);
        for (var i = 0; i < obs_marker_arr.length; i++) {
          obs_marker_arr[i].setMap(null);
        }


        const pol = arr.map(p => [p.lat, p.lng]);
        pol.push(pol[0])
        const shapefileFeature = turf.polygon([pol]);
        console.log(shapefileFeature);

        for (var i = 0; i < shapefile_geojson.length; i++) {
          if (shapefile_geojson[i].fileName == POLY_NAME) {
            shapefile_geojson[1].features.push(shapefileFeature);
          }
        }

        console.log(shapefile_geojson);


        obs_marker_arr = [];
        shapefile_polygon.setMap(null);
        shapefile_polygon = new google.maps.Polygon(
          {
            paths: path_arr,
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 3,
            fillColor: "#FF0000",
            fillOpacity: 0.35
          });


        shapefile_polygon.setMap(map);
        arr = [];


      });

      document.getElementById('button2').addEventListener("click", function () {
        arr.pop();
      });


      document.getElementById('button3').addEventListener("click", function () {
        var entry = shapefile_geojson;
        console.log(entry);

        fetch(`${window.origin}/shapefile/create-entry`,
          {
            method: "POST",
            credentials: "include",
            body: JSON.stringify(entry),
            cache: "no-cache",
            headers: new Headers(
              {
                "content-type": "application/json"
              })
          })

          .then(function (response) {
            if (response.status !== 200) {
              console.log(`Looks like there was a problem. Status code: ${response.status}`);
              return;
            }

            response.json().then(function (pathCoords) {
              console.log(pathcoords);

              document.getElementById('button4').addEventListener("click", function () {
                console.log(shapefile_geojson);

                var len = pathCoords.length;

                var total_len = 0;
                for (var i = 0; i < len; i++) {
                  total_len += pathCoords[i].length;
                  drone_len[i] = pathCoords[i].length;
                }

                for (var i = 0; i < len; i++) {
                  var new_route1 = new google.maps.Polyline(
                    {
                      path: pathCoords[i],
                      geodesic: true,
                      strokeColor: '#FF0000',
                      strokeOpacity: 1.0,
                      strokeWeight: 2,
                      editable: false,
                      map: map
                    });

                }
                var max = 0;
                //var path_len = 0;
                var temp = 0;
                for (var i = 0; i < len; i++) {
                  temp = (pathCoords[i].length * side) / speed[i];
                  if (temp > max) {
                    max = temp;
                    //path_len = pathCoords[i].length;
                  }
                }

                console.log(max);
                max = max * 60 * 2;


                autoRefresh(map, len, max, total_len);

              });
              //button 4
            });

          })

          .catch(function (error) {
            console.log("Fetch error: " + error);
          });

      });


      document.getElementById('button4').addEventListener("click", function () {
        console.log(shapefile_geojson);
        /*pathCoords = [[{'lat': 18.96170452729486, 'lng': 72.81252626485511},
{'lat': 18.960801116438496, 'lng': 72.81252626485511},
{'lat': 18.9608011164385, 'lng': 72.81347577475849},
{'lat': 18.961704527294863, 'lng': 72.8134757747585},
{'lat': 18.962607938063254, 'lng': 72.81347577475849},
{'lat': 18.96351134874367, 'lng': 72.81347577475849},
{'lat': 18.9644147593361, 'lng': 72.81347577475849},
{'lat': 18.965318169840547, 'lng': 72.8134757747585},
{'lat': 18.966221580257002, 'lng': 72.8134757747585},
{'lat': 18.96712499058548, 'lng': 72.8134757747585},
{'lat': 18.96802840082595, 'lng': 72.8134757747585},
{'lat': 18.968931810978425, 'lng': 72.8134757747585},
{'lat': 18.969835221042892, 'lng': 72.8134757747585},
{'lat': 18.969835221042892, 'lng': 72.81252626485511},
{'lat': 18.968931810978425, 'lng': 72.81252626485512},
{'lat': 18.96802840082595, 'lng': 72.81252626485511},
{'lat': 18.96712499058547, 'lng': 72.81252626485511},
{'lat': 18.966221580257006, 'lng': 72.81252626485511},
{'lat': 18.965318169840547, 'lng': 72.81252626485511},
{'lat': 18.964414759336098, 'lng': 72.8125262648551},
{'lat': 18.96351134874367, 'lng': 72.81252626485511},
{'lat': 18.962607938063258, 'lng': 72.81252626485511},
{'lat': 18.962607938063258, 'lng': 72.81252626485511},
{'lat': 18.962607938063254, 'lng': 72.81347577475849},
{'lat': 18.96351134874367, 'lng': 72.81347577475849},
{'lat': 18.96351134874367, 'lng': 72.81347577475849},
{'lat': 18.96351134874367, 'lng': 72.81442528466187},
{'lat': 18.962607938063258, 'lng': 72.81442528466187},
{'lat': 18.961704527294863, 'lng': 72.81442528466187},
{'lat': 18.960801116438496, 'lng': 72.81442528466187},
{'lat': 18.9608011164385, 'lng': 72.81537479456523},
{'lat': 18.961704527294863, 'lng': 72.81537479456522},
{'lat': 18.962607938063258, 'lng': 72.81537479456522},
{'lat': 18.962607938063258, 'lng': 72.81537479456522},
{'lat': 18.961704527294863, 'lng': 72.81537479456522},
{'lat': 18.961704527294863, 'lng': 72.81537479456522},
{'lat': 18.961704527294867, 'lng': 72.81632430446857},
{'lat': 18.960801116438496, 'lng': 72.81632430446857},
{'lat': 18.960801116438496, 'lng': 72.8172738143719},
{'lat': 18.960801116438496, 'lng': 72.8172738143719},
{'lat': 18.960801116438496, 'lng': 72.81632430446857},
{'lat': 18.961704527294867, 'lng': 72.81632430446857},
{'lat': 18.961704527294863, 'lng': 72.81537479456522},
{'lat': 18.961704527294863, 'lng': 72.81442528466187},
{'lat': 18.962607938063258, 'lng': 72.81442528466187},
{'lat': 18.962607938063254, 'lng': 72.81347577475849},
{'lat': 18.96351134874367, 'lng': 72.81347577475849},
{'lat': 18.96351134874367, 'lng': 72.81252626485511},
{'lat': 18.964414759336098, 'lng': 72.8125262648551},
{'lat': 18.964414759336098, 'lng': 72.8125262648551},
{'lat': 18.9644147593361, 'lng': 72.81157675495172},
{'lat': 18.965318169840547, 'lng': 72.81157675495172},
{'lat': 18.96622158025701, 'lng': 72.81157675495172},
{'lat': 18.96622158025701, 'lng': 72.81157675495172},
{'lat': 18.966221580257006, 'lng': 72.81252626485511},
{'lat': 18.96712499058547, 'lng': 72.81252626485511},
{'lat': 18.96802840082595, 'lng': 72.81252626485511},
{'lat': 18.96802840082595, 'lng': 72.8134757747585},
{'lat': 18.96802840082595, 'lng': 72.8134757747585},
{'lat': 18.96802840082595, 'lng': 72.81442528466188},
{'lat': 18.968931810978425, 'lng': 72.81442528466187},
{'lat': 18.96893181097843, 'lng': 72.81537479456523},
{'lat': 18.96802840082595, 'lng': 72.81537479456523},
{'lat': 18.96802840082595, 'lng': 72.81537479456523},
{'lat': 18.96802840082595, 'lng': 72.81442528466188},
{'lat': 18.96802840082595, 'lng': 72.8134757747585},
{'lat': 18.968931810978425, 'lng': 72.8134757747585},
{'lat': 18.968931810978425, 'lng': 72.81252626485512},
{'lat': 18.969835221042892, 'lng': 72.81252626485511},
{'lat': 18.969835221042892, 'lng': 72.81252626485511},
{'lat': 18.970738631019355, 'lng': 72.8125262648551}],
[{'lat': 18.964414759336098, 'lng': 72.8267689134045},
{'lat': 18.96351134874367, 'lng': 72.8267689134045},
{'lat': 18.962607938063254, 'lng': 72.82676891340449},
{'lat': 18.961704527294863, 'lng': 72.82676891340449},
{'lat': 18.960801116438496, 'lng': 72.82676891340449},
{'lat': 18.9608011164385, 'lng': 72.82771842330769},
{'lat': 18.961704527294867, 'lng': 72.8277184233077},
{'lat': 18.962607938063258, 'lng': 72.82771842330769},
{'lat': 18.96351134874367, 'lng': 72.82771842330769},
{'lat': 18.9644147593361, 'lng': 72.82771842330769},
{'lat': 18.965318169840547, 'lng': 72.82771842330769},
{'lat': 18.966221580257006, 'lng': 72.8277184233077},
{'lat': 18.967124990585475, 'lng': 72.82771842330769},
{'lat': 18.967124990585475, 'lng': 72.8267689134045},
{'lat': 18.96622158025701, 'lng': 72.8267689134045},
{'lat': 18.965318169840547, 'lng': 72.8267689134045},
{'lat': 18.965318169840543, 'lng': 72.8258194035013},
{'lat': 18.964414759336098, 'lng': 72.82581940350131},
{'lat': 18.96351134874367, 'lng': 72.8258194035013},
{'lat': 18.96351134874367, 'lng': 72.8258194035013},
{'lat': 18.964414759336098, 'lng': 72.82581940350131},
{'lat': 18.964414759336098, 'lng': 72.82581940350131},
{'lat': 18.964414759336098, 'lng': 72.82486989359809},
{'lat': 18.965318169840547, 'lng': 72.82486989359809},
{'lat': 18.965318169840547, 'lng': 72.82486989359809},
{'lat': 18.965318169840543, 'lng': 72.8258194035013},
{'lat': 18.965318169840543, 'lng': 72.8258194035013},
{'lat': 18.966221580257006, 'lng': 72.82581940350131},
{'lat': 18.966221580257006, 'lng': 72.82581940350131},
{'lat': 18.965318169840543, 'lng': 72.8258194035013},
{'lat': 18.964414759336098, 'lng': 72.82581940350131},
{'lat': 18.964414759336098, 'lng': 72.82486989359809},
{'lat': 18.964414759336098, 'lng': 72.82486989359809},
{'lat': 18.9644147593361, 'lng': 72.82392038369487},
{'lat': 18.9644147593361, 'lng': 72.82297087379163},
{'lat': 18.9644147593361, 'lng': 72.82202136388835},
{'lat': 18.9644147593361, 'lng': 72.82107185398509},
{'lat': 18.9644147593361, 'lng': 72.8201223440818},
{'lat': 18.965318169840547, 'lng': 72.82012234408181},
{'lat': 18.965318169840547, 'lng': 72.81917283417852},
{'lat': 18.9644147593361, 'lng': 72.81917283417852},
{'lat': 18.964414759336105, 'lng': 72.81822332427521},
{'lat': 18.964414759336098, 'lng': 72.8172738143719},
{'lat': 18.96351134874367, 'lng': 72.8172738143719},
{'lat': 18.96351134874367, 'lng': 72.81632430446855},
{'lat': 18.962607938063258, 'lng': 72.81632430446857},
{'lat': 18.962607938063258, 'lng': 72.81632430446857},
{'lat': 18.96351134874367, 'lng': 72.81632430446855},
{'lat': 18.96351134874367, 'lng': 72.81632430446855},
{'lat': 18.9644147593361, 'lng': 72.81632430446857},
{'lat': 18.9644147593361, 'lng': 72.81537479456522},
{'lat': 18.96351134874367, 'lng': 72.81537479456523},
{'lat': 18.96351134874367, 'lng': 72.81537479456523},
{'lat': 18.9644147593361, 'lng': 72.81537479456522},
{'lat': 18.9644147593361, 'lng': 72.81537479456522},
{'lat': 18.9644147593361, 'lng': 72.81442528466188},
{'lat': 18.965318169840543, 'lng': 72.81442528466187},
{'lat': 18.965318169840543, 'lng': 72.81442528466187},
{'lat': 18.9644147593361, 'lng': 72.81442528466188},
{'lat': 18.9644147593361, 'lng': 72.81537479456522},
{'lat': 18.9644147593361, 'lng': 72.81632430446857},
{'lat': 18.964414759336098, 'lng': 72.8172738143719},
{'lat': 18.964414759336105, 'lng': 72.81822332427521},
{'lat': 18.9644147593361, 'lng': 72.81917283417852},
{'lat': 18.9644147593361, 'lng': 72.8201223440818},
{'lat': 18.9644147593361, 'lng': 72.82107185398509},
{'lat': 18.9644147593361, 'lng': 72.82202136388835},
{'lat': 18.9644147593361, 'lng': 72.82297087379163},
{'lat': 18.9644147593361, 'lng': 72.82392038369487},
{'lat': 18.964414759336098, 'lng': 72.82486989359809},
{'lat': 18.964414759336098, 'lng': 72.82581940350131},
{'lat': 18.96351134874367, 'lng': 72.8258194035013},
{'lat': 18.96351134874367, 'lng': 72.8267689134045},
{'lat': 18.962607938063254, 'lng': 72.82676891340449},
{'lat': 18.961704527294863, 'lng': 72.82676891340449},
{'lat': 18.960801116438496, 'lng': 72.82676891340449},
{'lat': 18.960801116438496, 'lng': 72.82676891340449},
{'lat': 18.960801116438496, 'lng': 72.8258194035013}],
[{'lat': 18.968028400825947, 'lng': 72.82392038369485},
{'lat': 18.96712499058548, 'lng': 72.82392038369484},
{'lat': 18.966221580257002, 'lng': 72.82392038369485},
{'lat': 18.965318169840547, 'lng': 72.82392038369485},
{'lat': 18.965318169840547, 'lng': 72.82297087379162},
{'lat': 18.966221580257006, 'lng': 72.82297087379163},
{'lat': 18.967124990585475, 'lng': 72.82297087379162},
{'lat': 18.967124990585475, 'lng': 72.82202136388835},
{'lat': 18.966221580257006, 'lng': 72.82202136388835},
{'lat': 18.965318169840543, 'lng': 72.82202136388835},
{'lat': 18.965318169840547, 'lng': 72.82107185398507},
{'lat': 18.966221580257006, 'lng': 72.82107185398509},
{'lat': 18.967124990585475, 'lng': 72.82107185398509},
{'lat': 18.967124990585475, 'lng': 72.8201223440818},
{'lat': 18.966221580257006, 'lng': 72.82012234408181},
{'lat': 18.966221580257006, 'lng': 72.81917283417853},
{'lat': 18.966221580257006, 'lng': 72.81917283417853},
{'lat': 18.966221580257006, 'lng': 72.82012234408181},
{'lat': 18.967124990585475, 'lng': 72.8201223440818},
{'lat': 18.967124990585475, 'lng': 72.8201223440818},
{'lat': 18.96802840082595, 'lng': 72.82012234408181},
{'lat': 18.96802840082595, 'lng': 72.82012234408181},
{'lat': 18.967124990585475, 'lng': 72.8201223440818},
{'lat': 18.967124990585475, 'lng': 72.82107185398509},
{'lat': 18.967124990585475, 'lng': 72.82202136388835},
{'lat': 18.967124990585475, 'lng': 72.82297087379162},
{'lat': 18.96712499058548, 'lng': 72.82392038369484},
{'lat': 18.966221580257002, 'lng': 72.82392038369485},
{'lat': 18.966221580257002, 'lng': 72.82392038369485},
{'lat': 18.966221580257006, 'lng': 72.82486989359809},
{'lat': 18.967124990585475, 'lng': 72.82486989359808},
{'lat': 18.96802840082595, 'lng': 72.82486989359809},
{'lat': 18.968931810978425, 'lng': 72.8248698935981},
{'lat': 18.968931810978425, 'lng': 72.82581940350131},
{'lat': 18.96802840082595, 'lng': 72.8258194035013},
{'lat': 18.96712499058548, 'lng': 72.8258194035013},
{'lat': 18.96712499058548, 'lng': 72.8258194035013},
{'lat': 18.96802840082595, 'lng': 72.8258194035013},
{'lat': 18.96802840082595, 'lng': 72.8258194035013},
{'lat': 18.968028400825947, 'lng': 72.82676891340449},
{'lat': 18.96893181097842, 'lng': 72.8267689134045},
{'lat': 18.969835221042896, 'lng': 72.8267689134045},
{'lat': 18.970738631019355, 'lng': 72.82676891340449},
{'lat': 18.97164204090781, 'lng': 72.8267689134045},
{'lat': 18.972545450708253, 'lng': 72.8267689134045},
{'lat': 18.97254545070825, 'lng': 72.82771842330769},
{'lat': 18.97164204090781, 'lng': 72.8277184233077},
{'lat': 18.970738631019355, 'lng': 72.82771842330769},
{'lat': 18.969835221042892, 'lng': 72.8277184233077},
{'lat': 18.968931810978425, 'lng': 72.8277184233077},
{'lat': 18.968028400825947, 'lng': 72.8277184233077},
{'lat': 18.968028400825947, 'lng': 72.8277184233077},
{'lat': 18.968931810978425, 'lng': 72.8277184233077},
{'lat': 18.969835221042892, 'lng': 72.8277184233077},
{'lat': 18.970738631019355, 'lng': 72.82771842330769},
{'lat': 18.97164204090781, 'lng': 72.8277184233077},
{'lat': 18.97164204090781, 'lng': 72.8267689134045},
{'lat': 18.97164204090781, 'lng': 72.8267689134045},
{'lat': 18.97164204090781, 'lng': 72.8258194035013},
{'lat': 18.972545450708253, 'lng': 72.8258194035013},
{'lat': 18.973448860420675, 'lng': 72.8258194035013},
{'lat': 18.973448860420675, 'lng': 72.8258194035013},
{'lat': 18.972545450708253, 'lng': 72.8258194035013},
{'lat': 18.972545450708253, 'lng': 72.8258194035013},
{'lat': 18.972545450708253, 'lng': 72.82486989359809}],
[{'lat': 18.969835221042892, 'lng': 72.8172738143719},
{'lat': 18.969835221042892, 'lng': 72.8182233242752},
{'lat': 18.969835221042896, 'lng': 72.81917283417853},
{'lat': 18.968931810978425, 'lng': 72.8191728341785},
{'lat': 18.968931810978425, 'lng': 72.82012234408181},
{'lat': 18.969835221042896, 'lng': 72.82012234408181},
{'lat': 18.970738631019355, 'lng': 72.8201223440818},
{'lat': 18.971642040907806, 'lng': 72.82012234408181},
{'lat': 18.972545450708253, 'lng': 72.8201223440818},
{'lat': 18.97254545070825, 'lng': 72.8210718539851},
{'lat': 18.97164204090781, 'lng': 72.82107185398509},
{'lat': 18.970738631019355, 'lng': 72.82107185398509},
{'lat': 18.969835221042892, 'lng': 72.82107185398509},
{'lat': 18.969835221042892, 'lng': 72.82107185398509},
{'lat': 18.970738631019355, 'lng': 72.82107185398509},
{'lat': 18.970738631019355, 'lng': 72.82107185398509},
{'lat': 18.97073863101936, 'lng': 72.82202136388835},
{'lat': 18.97164204090781, 'lng': 72.82202136388835},
{'lat': 18.972545450708253, 'lng': 72.82202136388835},
{'lat': 18.973448860420675, 'lng': 72.82202136388835},
{'lat': 18.973448860420675, 'lng': 72.82202136388835},
{'lat': 18.972545450708253, 'lng': 72.82202136388835},
{'lat': 18.97254545070825, 'lng': 72.8210718539851},
{'lat': 18.972545450708253, 'lng': 72.8201223440818},
{'lat': 18.972545450708253, 'lng': 72.8201223440818},
{'lat': 18.972545450708253, 'lng': 72.8191728341785},
{'lat': 18.971642040907806, 'lng': 72.81917283417852},
{'lat': 18.970738631019355, 'lng': 72.81917283417852},
{'lat': 18.970738631019355, 'lng': 72.81917283417852},
{'lat': 18.971642040907806, 'lng': 72.81917283417852},
{'lat': 18.972545450708253, 'lng': 72.8191728341785},
{'lat': 18.972545450708253, 'lng': 72.8191728341785},
{'lat': 18.972545450708253, 'lng': 72.81822332427521},
{'lat': 18.973448860420675, 'lng': 72.81822332427522},
{'lat': 18.973448860420675, 'lng': 72.81727381437189},
{'lat': 18.972545450708253, 'lng': 72.8172738143719},
{'lat': 18.972545450708253, 'lng': 72.8172738143719},
{'lat': 18.973448860420675, 'lng': 72.81727381437189},
{'lat': 18.973448860420675, 'lng': 72.81727381437189},
{'lat': 18.973448860420678, 'lng': 72.81632430446858},
{'lat': 18.973448860420675, 'lng': 72.81537479456523},
{'lat': 18.973448860420675, 'lng': 72.81442528466187},
{'lat': 18.972545450708253, 'lng': 72.81442528466187},
{'lat': 18.97164204090781, 'lng': 72.81442528466187},
{'lat': 18.970738631019355, 'lng': 72.81442528466187},
{'lat': 18.969835221042896, 'lng': 72.81442528466187},
{'lat': 18.969835221042896, 'lng': 72.81442528466187},
{'lat': 18.970738631019355, 'lng': 72.81442528466187},
{'lat': 18.970738631019355, 'lng': 72.81442528466187},
{'lat': 18.970738631019355, 'lng': 72.8134757747585},
{'lat': 18.97164204090781, 'lng': 72.8134757747585},
{'lat': 18.972545450708253, 'lng': 72.8134757747585},
{'lat': 18.973448860420675, 'lng': 72.8134757747585},
{'lat': 18.973448860420675, 'lng': 72.81252626485511},
{'lat': 18.972545450708253, 'lng': 72.81252626485511},
{'lat': 18.971642040907806, 'lng': 72.81252626485512},
{'lat': 18.971642040907806, 'lng': 72.81252626485512},
{'lat': 18.972545450708253, 'lng': 72.81252626485511},
{'lat': 18.972545450708253, 'lng': 72.81252626485511},
{'lat': 18.972545450708253, 'lng': 72.81157675495172},
{'lat': 18.973448860420675, 'lng': 72.81157675495172}]];
    
    //pathCoords2 = [{ "lat":18.957065859327418, "lng": 72.82310881341961 }, { "lat":18.957512323578108, "lng":72.83302225793865 }, 
                      //{ "lat":18.951748784128412, "lng": 72.83572592462566}, { "lat":18.957065859327418, "lng": 72.82310881341961 } ]

          //pathCoords = [pathCoords1, pathCoords2];*/
        var len = pathCoords.length;

        var total_len = 0;
        for (var i = 0; i < len; i++) {
          total_len += pathCoords[i].length;
          drone_len[i] = pathCoords[i].length;
        }

        for (var i = 0; i < len; i++) {
          var new_route1 = new google.maps.Polyline(
            {
              path: pathCoords[i],
              geodesic: true,
              strokeColor: '#FF0000',
              strokeOpacity: 1.0,
              strokeWeight: 2,
              editable: false,
              map: map
            });

        }
        var max = 0;
        //var path_len = 0;
        var temp = 0;
        for (var i = 0; i < len; i++) {
          temp = (pathCoords[i].length * side) / speed[i];
          if (temp > max) {
            max = temp;
            //path_len = pathCoords[i].length;
          }
        }

        console.log(max);
        max = max * 60 * 2;


        autoRefresh(map, len, max, total_len);

      });




      document.getElementById('button5').addEventListener("click", function () {

        altitude = document.getElementById("altitude");
        fov = document.getElementById("fov");
        un_kn_obstacle = (document.getElementById("select_input").selectedIndex != 1);  //false = unknown 
        side = (2 * altitude * Math.tan((fov / 57.2958) / 2)) / Math.sqrt(2);
        side = side / 1000;

        entry1 = {
          altitude: altitude.value,
          fov: fov.value
        };

        console.log(side);
        if (no_drones == 1) {
          value_no_drones = document.getElementById("drone").value;
          entry1.value_no_drones= drone.value;

        }


        if (no_drones < value_no_drones) {
          document.getElementById("heading").innerHTML = "DRONE " + (no_drones + 1);
        }

        if (no_drones <= value_no_drones) {

          range.push(document.getElementById("range"));
          speed.push(document.getElementById("speed"));

          entry1.range=range.value;
          entry1.speed=speed.value;

          sessionStorage.setItem("entry1", JSON.stringify(entry1));
          fetch(`${window.origin}/input/hello`, {
            method: "POST",
            credentials: "include",
            body: JSON.stringify(entry1),
            cache: "no-cache",
            headers: new Headers({
              "content-type": "application/json"
            })
          })
            .then(function (response) {
              if (response.status !== 200) {
                console.log(`Looks like there was a problem. Status code: ${response.status}`);
                return;
              }
              response.json().then(function (data) {
                console.log(data);
              });
            })
            .catch(function (error) {
              console.log("Fetch error: " + error);
            });
          document.getElementById("range").value = null;
          document.getElementById("speed").value = null;
        }

        no_drones += 1;

        if (no_drones == value_no_drones) {
          document.getElementById("button5").innerHTML = "<b>PROCEED</b>";
        }

        else if (no_drones > value_no_drones) {
          document.getElementById("button5").disabled = true;
          for (var i = 1; i < value_no_drones; i++) {
            document.getElementById("select_input1").innerHTML += "<option value=\"drone" + (i + 1) + "\"> Drone " + (i + 1) + "</option>";
          }
        }


      });

      document.getElementById('button6').addEventListener("click", function () {
        flag_fuel = true;
        flag_strt = false;
        shapefile_polygon.addListener('click', function (mapsMouseEvent) {
          if (flag_fuel) {
            // Close the current InfoWindow.
            infoWindow.close();
            // Create a new InfoWindow.
            infoWindow = new google.maps.InfoWindow({ position: mapsMouseEvent.latLng });
            infoWindow.setContent(mapsMouseEvent.latLng.toString());
            infoWindow.open(map);
            const lat = mapsMouseEvent.latLng.lat();
            const lng = mapsMouseEvent.latLng.lng();

            fuel_marker = new google.maps.Marker(
              {
                position: mapsMouseEvent.latLng,
                map: map
              });

            fuel_marker_arr.push(fuel_marker);
            //ADD COORDINATES TO shapefile_geojson
          }


        });

      });

      document.getElementById('button7').addEventListener("click", function () {
        var len = fuel_marker_arr.length;
        fuel_marker_arr[len - 1].setMap(null);
        fuel_marker_arr.pop();
      });

      document.getElementById('button8').addEventListener("click", function () {
        flag_fuel = false;
        flag_strt = true;
        shapefile_polygon.addListener('click', function (mapsMouseEvent) {
          if (flag_strt) {
            // Close the current InfoWindow.
            infoWindow.close();
            // Create a new InfoWindow.
            infoWindow = new google.maps.InfoWindow({ position: mapsMouseEvent.latLng });
            infoWindow.setContent(mapsMouseEvent.latLng.toString());
            infoWindow.open(map);
            const lat = mapsMouseEvent.latLng.lat();
            const lng = mapsMouseEvent.latLng.lng();

            drone_marker = new google.maps.Marker(
              {
                position: mapsMouseEvent.latLng,
                map: map
              });

            drone_marker_arr.push(drone_marker);
            //ADD COORDINATES TO shapefile_geojson
          }
        });

      });

      document.getElementById('button9').addEventListener("click", function () {
        var len = drone_marker_arr.length;
        drone_marker_arr[len - 1].setMap(null);
        drone_marker_arr.pop();
      });



      function moveMarker(map, marker, latlng) {
        marker.setPosition(latlng);
      }

      function autoRefresh(map, len, max, total_len) {
        var i, route1, marker1, marker2;

        var vis_arr = [];

        for (var i = 0; i < len; i++) {
          route1 = new google.maps.Polyline(
            {
              path: [],
              strokeColor: '#008000',
              strokeOpacity: 0.5,
              strokeWeight: 14,
              editable: false,
              map: map
            });
          //console.log(route1);
          route.push(route1);

          marker1 = new google.maps.Marker({ map: map, icon: "http://maps.google.com/mapfiles/ms/micons/blue.png" });
          console.log(marker);
          ani_marker.push(marker1);
        }


        var drone_prog_count = [];
        for (let p = 0; p < route.length; p++) {
          var count = 0;
          drone_prog_count.push(0);
          //console.log(j);
          for (i = 0; i < pathCoords[p].length; i++) {
            setTimeout(function (coords) {
              if (((range[p] - drone_prog_count[p] * side) / range[p] * 100)) {
                var latlng = new google.maps.LatLng(coords.lat, coords.lng);
                route[p].getPath().push(latlng);
                vis_arr.push((coords.lat, coords.lng));
                moveMarker(map, ani_marker[p], latlng);
                count = vis_arr.length;
                value = (count / (total_len)) * 100;
                drone_val[p] = (drone_arr[p] / drone_len[p]) * 100;
                document.getElementById("file").value = value;
                drone_prog_count[p]++;
              }

              if (p == document.getElementById("select_input1").selectedIndex) {
                document.getElementById("file1").value = (drone_prog_count[p] / pathCoords[p].length * 100);
                document.getElementById("file2").value = ((range[p] - drone_prog_count[p] * side) / range[p] * 100);
              }

            }, (3600000 * side * i) / (speed[p] * max * 2), pathCoords[p][i], p);
          }
        }
      }
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkLQlSCLpYWPwDRI2Sjbnpk4DVkRpneSU&callback=initMap"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
</body>

</html>